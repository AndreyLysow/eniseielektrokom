# Рекомендации по оптимизации проекта

## Выявленные проблемы и решения

### 1. Prisma Client Singleton Pattern ✅ ИСПРАВЛЕНО

**Проблема**: В `pages/api/login.js` Prisma Client создается заново при каждом запросе, что неэффективно.

**Решение**: Использовать singleton pattern как в `register.js`.

**Файл**: `pages/api/login.js`

**Статус**: ✅ Применено - добавлен singleton pattern, убран `$disconnect()` из finally блока

---

### 2. Неоптимизированные изображения ✅ ИСПРАВЛЕНО

**Проблема**: В `header.js` и `footer.js` используется флаг `unoptimized`, что отключает оптимизацию Next.js.

**Решение**: Убрать `unoptimized` и использовать стандартную оптимизацию Next.js Image.

**Файлы**: 
- `components/header.js` (строка 113)
- `components/footer.js` (строка 45)

**Статус**: ✅ Применено - убраны флаги `unoptimized` из обоих файлов

---

### 3. Видео без оптимизации ✅ ИСПРАВЛЕНО

**Проблема**: Большое видео `eniseysk2.mp4` загружается без poster изображения и оптимизации.

**Рекомендации**:
- Добавить poster изображение для быстрой загрузки
- Использовать `loading="lazy"` для видео (если возможно)
- Рассмотреть использование WebM формата для лучшей компрессии

**Файл**: `components/AnimatedBackground.js`

**Статус**: ✅ Применено - добавлен `poster="/logoetk.png"` для быстрой загрузки

---

### 4. Prefetch отключен везде ✅ ИСПРАВЛЕНО

**Проблема**: Во всех Link компонентах используется `prefetch={false}`, что замедляет навигацию.

**Решение**: Включить prefetch для важных страниц (главная, новости, объявления).

**Файлы**: 
- `components/header.js` (множественные места)
- `components/footer.js`

**Статус**: ✅ Применено - включен prefetch для внутренних ссылок, отключен только для внешних ссылок

---

### 5. Bundle Size ⚠️

**Рекомендации**:
- Проверить размер bundle: `npm run build` и посмотреть `.next/analyze`
- Рассмотреть динамические импорты для тяжелых библиотек (tsparticles, swiper)
- Использовать tree-shaking для неиспользуемых компонентов

---

### 6. Database Connection Pooling ⚠️

**Проблема**: В `register.js` используется `prisma.$disconnect()` в finally, что может быть излишним при использовании singleton.

**Рекомендация**: Убрать `$disconnect()` из finally блока, так как singleton должен переиспользовать соединение.

---

## Приоритеты оптимизации

1. **Высокий**: Prisma Client singleton, убрать unoptimized
2. **Средний**: Prefetch для важных страниц, оптимизация видео
3. **Низкий**: Bundle size анализ, database pooling

---

## Метрики производительности

Рекомендуется проверить:
- Lighthouse Score (цель: 90+)
- First Contentful Paint (FCP)
- Largest Contentful Paint (LCP)
- Time to Interactive (TTI)
- Bundle size

---

## Дополнительные рекомендации

1. **CDN**: Использовать CDN для статических файлов
2. **Image Optimization**: Рассмотреть использование внешнего сервиса оптимизации изображений
3. **Caching**: Настроить более агрессивное кэширование для API endpoints
4. **Monitoring**: Добавить мониторинг производительности (например, Vercel Analytics)

