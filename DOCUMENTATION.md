# Документация проекта Енисейэлектроком

## Описание проекта

Веб-сайт компании ООО «Енисейская электроснабжающая компания» — информационный портал для абонентов с функциями новостей, объявлений, тарифов, личного кабинета и других сервисов.

## Технологический стек

- **Framework**: Next.js 15.2.4 (Pages Router)
- **React**: 19.0.0
- **База данных**: 
  - MySQL (Prisma ORM) — для пользователей
  - SQLite (better-sqlite3) — для счетчиков просмотров
- **Стилизация**: CSS Modules, Bootstrap 5.3.3, Tailwind CSS 4.0.17
- **Анимации**: Framer Motion 12.6.2, react-tsparticles
- **Другие библиотеки**:
  - react-markdown — для отображения новостей
  - swiper — для слайдеров
  - bcryptjs — для хеширования паролей
  - js-cookie — для работы с cookies

## Структура проекта

```
eniseielektrokom/
├── components/          # React компоненты
│   ├── main/           # Главная страница
│   ├── articles/       # Статьи и нормативы
│   ├── announcements/  # Объявления
│   ├── vacancies/      # Вакансии
│   └── ...
├── pages/              # Next.js страницы и API роуты
│   ├── api/           # API endpoints
│   │   ├── login.js   # Авторизация
│   │   ├── register.js # Регистрация
│   │   └── views/     # Счетчики просмотров
│   ├── news/          # Новости
│   ├── articles/      # Статьи
│   └── ...
├── public/            # Статические файлы
│   ├── images/       # Изображения
│   ├── documents/     # PDF документы
│   └── ...
├── styles/            # CSS модули
├── lib/               # Утилиты
│   ├── db.js         # SQLite подключение
│   └── ip.js         # IP хеширование
├── prisma/           # Prisma схема и миграции
├── news-content/     # Markdown файлы новостей
└── utils/            # Вспомогательные функции
```

## Основные функции

### 1. Новости
- Отображение списка новостей с пагинацией
- Детальные страницы новостей из Markdown файлов
- Счетчик просмотров (уникальные IP, раз в сутки)

### 2. Абонентам
- Объявления и официальные сообщения
- Тарифы на услуги
- Типовые договоры
- График отключений
- Статьи и нормативы

### 3. Аутентификация
- Регистрация пользователей
- Авторизация через API
- Хеширование паролей (bcrypt)

### 4. Другие разделы
- О компании
- Контакты и реквизиты
- Вакансии
- Раскрытие информации
- Политика конфиденциальности

## API Endpoints

### `/api/login`
- **Метод**: POST
- **Тело**: `{ username, password }`
- **Ответ**: `{ message, user: { id, username, name } }`

### `/api/register`
- **Метод**: POST
- **Тело**: `{ username, name, email, password }`
- **Ответ**: `{ message, user: { id, username, name, email } }`

### `/api/views/increment`
- **Метод**: POST
- **Тело**: `{ id }` (ID новости)
- **Ответ**: `{ ok, id, total, incremented }`
- **Логика**: Учитывает уникальные IP, один просмотр в сутки

### `/api/views/bulk`
- **Метод**: POST
- **Тело**: `{ ids: [] }` (массив ID новостей)
- **Ответ**: `{ ok, counts: { id1: count1, id2: count2, ... } }`

## База данных

### MySQL (Prisma)
Таблица `users`:
- `id` (Int, PK, autoincrement)
- `username` (String, unique)
- `name` (String)
- `email` (String, unique)
- `password` (String, hashed)

### SQLite (better-sqlite3)
Таблица `ip_views`:
- `id` (TEXT, PK) — ID новости
- `ip_hash` (TEXT, PK) — хеш IP адреса
- `ts` (INTEGER) — timestamp последнего просмотра

Таблица `totals`:
- `id` (TEXT, PK) — ID новости
- `count` (INTEGER) — общее количество просмотров

## Конфигурация

### next.config.mjs
- Оптимизация изображений (AVIF, WebP)
- Компрессия включена
- Кэширование статических файлов (1 год)
- React Strict Mode включен

### Переменные окружения
Необходимо создать `.env` файл:
```env
DATABASE_URL="mysql://user:password@host:port/database"
```

## Разработка

### Установка зависимостей
```bash
npm install
```

### Запуск в режиме разработки
```bash
npm run dev
```

### Сборка для продакшена
```bash
npm run build
npm start
```

### Миграции Prisma
```bash
npx prisma migrate dev
npx prisma generate
```

## Оптимизации

### Реализованные
- ✅ Оптимизация изображений через Next.js Image
- ✅ Кэширование статических файлов
- ✅ Динамические импорты для модалок
- ✅ Lazy loading изображений
- ✅ Компрессия ответов сервера

### Рекомендуемые улучшения
См. раздел "Оптимизации" ниже.

## Развертывание

Проект готов к развертыванию на платформах:
- Vercel (рекомендуется для Next.js)
- Другие Node.js хостинги

Требования:
- Node.js 18+
- MySQL база данных
- Доступ к файловой системе для SQLite

## Лицензия

Проект разработан для ООО «Енисейская электроснабжающая компания».

